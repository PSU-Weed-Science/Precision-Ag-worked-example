---
title: "See and Spray project"
author: "L Sencenbaugh"
date: "2026-02-17"
output: html_document
---




## Uploading new fields




####### Load packages

```{r}

#install.packages("cleanRfield")
library(cleanRfield)

#install.packages("devtools")
#devtools::install_github("cldossantos/pacu")

#devtools::install_github("filipematias23/cleanRfield")
library(terra) #raster stuff
library(dplyr) #organization
library(sf) #zone delination
library(ggplot2) #plotting
library(ggpubr) #plotting
library(tidyr) #pivot long
library(emmeans) #analysis
library(multcomp) #analysis
```


## Yield

Naming convention

F for field
36A name of specific field
_21 year of observation

The boundary of the field throughout will just be 
F36A_shape

October 2020

```{r}
par(mfrow=c(1,2))

F36A_20 <- vect("PSU-FS-36A/PSU Farm Ser_Farm 36_36A_Harvest_2020-10-20_00.shp") # make sure it's the .shp
plot(F36A_20, main="2020")

F36A_shape <- vect("PSU-FS-36A/boundaries_36A.shp") #.shp
plot(F36A_shape, main="Field Boundary")

```


###### TEMPLATE

The template has to be created here because we need to upload the boundary file first

Template naming convention will be like above

F36A_template

```{r}
F36A_template <- rast(
  ext(F36A_shape),
  resolution = 0.00008, #make it medium tiny
  crs = crs(F36A_shape) # keep original boundary
)
```


Resample using the new boundary (the template)

```{r}
#this makes the vector from above into a RASTER
F36A_20.R <- rasterField( #adding .R here while doing the creation
  field = F36A_20, 
  trait = c("DRYMATTER"), #for yield only need dry matter
  res = 0.00008
)

F36A_20.R <- resample(F36A_20.R, F36A_template, method = "bilinear") #keep .R so we know the raster version from the vector
```



November 2021

```{r}
F36A_21 <- vect("PSU-FS-36A/PSU Farm Ser_Farm 36_36A_Harvest_2021-11-07_00.shp")
plot(F36A_21, main="2021")

# do not need to reupload the shape each time 
#because this is the same field
```

```{r}
F36A_21.R <- rasterField(
  field = F36A_21, 
  trait = c("DRYMATTER"),
  res = 0.00008
)

F36A_21.R <- resample(F36A_21.R, F36A_template, method = "bilinear")
```


December 2022

```{r}
F36A_22 <- vect("PSU-FS-36A/PSU Farm Ser_Farm 36_36A_Harvest_2022-12-13_00.shp")
plot(F36A_22, main="2022")


```

```{r}

F36A_22.R <- rasterField(
  field = F36A_22, 
  trait = c("DRYMATTER"),
  res = 0.00008
)

F36A_22.R <- resample(F36A_22.R, F36A_template, method = "bilinear")
```


October 2023

```{r}
F36A_23 <- vect("PSU-FS-36A/PSU Farm Ser_Farm 36_36A_Harvest_2023-10-26_00.shp")
plot(F36A_23, main="2023")
```

```{r}
F36A_23.R <- rasterField(
  field = F36A_23, 
  trait = c("DRYMATTER"),
  res = 0.00008
)

F36A_23.R <- resample(F36A_23.R, F36A_template, method = "bilinear")
```


November 2024

```{r}
F36A_24 <- vect("PSU-FS-36A/PSU Farm Ser_Farm 36_36A_Harvest_2024-11-13_00.shp")
plot(F36A_24, main="Data Point")
```

```{r}
F36A_24.R <- rasterField(
  field = F36A_24, 
  trait = c("DRYMATTER"),
  res = 0.00008
)

F36A_24.R <- resample(F36A_24.R, F36A_template, method = "bilinear")
```



October 2025
```{r}
F36A_25 <- vect("PSU-FS-36A/PSU Farm Ser_Farm 36_36A_Harvest_2025-10-29_00.shp")
plot(F36A_25, main="Data Point")
```


```{r}
F36A_25.R <- rasterField(
  field = F36A_25, 
  trait = c("DRYMATTER"),
  res = 0.00008
)

F36A_25.R <- resample(F36A_25.R, F36A_template, method = "bilinear")
```


## Spray
Unfortunately here there is a change in resolution.
The top chunk will fix that for you.

This is all math you don't need to worry about
```{r}
field_utm <- project(F36A_shape, "EPSG:32618")
#crs(field_utm)
target_res_m <- 0.165161 # John suspected the spray observations were 16" (this is in meters)

#at 40 N 1 degree latitude is 111,111 meters
#at any longitude a degree is 85,394 meters

w <- 85394 #width long
h <- 111111 #height lat
A_in_m <- w * h # 1 square degree in square meters
# now convert to our target?
A_in_degrees <- 0.165161/A_in_m #area

target_res_degrees <- target_res_m/111000

F36A_template <- rast(
  ext(F36A_shape),
  resolution = target_res_degrees, 
  crs = crs(F36A_shape)
)

```


See and Spray July data

Naming-- add _s to end for spray data
F36A_25_s
```{r}
F36A_25_s <- vect("PSU-FS-36A/PSU Farm Ser_Farm 36_36A_Application_2025-07-07_00.shp")
plot(F36A_25_s, main="2025 spray")
```


```{r  }
F36A_25_s.R <- rasterField(
  field = F36A_25_s, 
  trait = c("AppliedRate", "TargetRate"), # adding here applied and target
  res = target_res_degrees) # this resolution is good for spray

F36A_25_s.R <- resample(F36A_25_s.R, F36A_template, method = "bilinear")

```

